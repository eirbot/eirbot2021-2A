{"version":3,"sources":["webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?ff37","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css","webpack:///./node_modules/lodash/noop.js","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetGroupViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx","webpack:///./node_modules/lodash/toInteger.js","webpack:///./node_modules/lodash/_baseFindIndex.js","webpack:///./node_modules/lodash/findLastIndex.js"],"names":["MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","startA","endA","startB","getPrimaryLocation","issue","component","textRange","endLine","endOffset","startLine","startOffset","createSnippets","params","locations","hasSecondaryLocations","secondaryLocations","length","ranges","undefined","reduce","snippets","loc","index","firstCollision","startIndex","Math","max","endIndex","locationEnd","issueEndLine","addLinesBellow","filter","snippet","start","end","keep","min","push","sort","a","b","linesForSnippets","componentLines","map","lines","i","groupLocationsByComponent","components","currentGroup","currentComponent","groups","addGroup","componentKey","key","measures","path","project","projectName","q","uuid","sources","every","forEach","expandSnippet","direction","snippetIndex","snippetToExpand","find","s","Error","toDelete","inSnippet","line","props","doScroll","element","scroll","parent","snippetNodeRef","current","offset","getBoundingClientRect","width","leftOffset","rightOffset","scrollToLastExpandedRow","snippetNode","rows","querySelectorAll","lastRow","expandBlock","then","renderLine","displayDuplications","displaySCM","issuesForLine","issueLocations","symbols","verticalBuffer","secondaryIssueLocations","this","duplications","duplicationsByLine","duplicationsCount","lineDuplications","isSinkLine","some","noop","branchLike","displayAllIssues","displayCoverage","displayIssues","displayLocationMarkers","highlighted","highlightedLocationMessage","highlightedSymbols","issuePopup","issues","last","loadDuplications","onIssueChange","onIssuePopupToggle","onIssueSelect","onIssueUnselect","onIssuesClose","handleCloseIssues","onIssuesOpen","handleOpenIssues","onLocationSelect","onSymbolClick","handleSymbolClick","openIssues","openIssuesByLine","previousLine","renderDuplicationPopup","selectedIssue","render","issuesByLine","lastSnippetOfLastGroup","locationsByLine","lastLine","parseInt","bottomLine","issueLine","lowestVisibleIssue","Object","keys","k","l","Boolean","className","ref","onClick","type","api","content","__esModule","default","module","options","exported","locals","exports","___CSS_LOADER_API_IMPORT___","mounted","rootNodeRef","state","additionalLines","loading","Promise","reject","extension","range","from","to","lineMap","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","setState","clickedSymbols","symb","includes","snippetGroup","componentDidMount","createSnippetsFromProps","componentWillUnmount","getNodes","root","querySelector","wrapper","table","firstChild","cleanDom","nodes","style","marginTop","maxHeight","setMaxHeight","value","up","height","startHeight","transition","setTimeout","resolve","renderSnippet","SnippetViewer","isLastOccurenceOfPrimaryComponent","lastSnippetGroup","fullyShown","snippetLines","includeIssueLocation","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","Issue","onChange","onPopupToggle","openPopup","name","selected","id","notAccessible","fetchDuplications","r","duplicatedFiles","files","handleIssuePopupToggle","popupName","open","samePopup","blocks","Consumer","openComponent","DuplicationPopup","inRemovedComponent","fetchIssueFlowSnippets","componentWillReceiveProps","newProps","issueKey","onLoaded","response","status","throwGlobalError","Alert","variant","issuesByComponent","locationsByComponent","lastOccurenceOfPrimaryComponent","SourceViewerContext","Provider","selectedFlowIndex","file","toFinite","result","remainder","array","predicate","fromIndex","fromRight","baseFindIndex","baseIteratee","toInteger","nativeMax","nativeMin"],"mappings":"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","file":"js/320.1613385090031.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nexport function getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  component: string;\n  issue: T.Issue;\n  locations: T.FlowLocation[];\n}): T.Snippet[] {\n  const { component, issue, locations } = params;\n\n  const hasSecondaryLocations = issue.secondaryLocations.length > 0;\n  const addIssueLocation =\n    hasSecondaryLocations && issue.component === component && issue.textRange !== undefined;\n\n  // For each location: compute its range, and then compare with other ranges\n  // to merge snippets that collide.\n  const ranges = (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n\n  // Sort snippets by line number in the case of secondary locations\n  // Preserve location order for flows!\n  return hasSecondaryLocations ? ranges.sort((a, b) => a.start - b.start) : ranges;\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  issue: T.Issue,\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  const addGroup = (componentKey: string) => {\n    currentGroup = {\n      ...(components[componentKey] || unknownComponent(componentKey)),\n      locations: []\n    };\n    groups.push(currentGroup);\n    currentComponent = componentKey;\n  };\n\n  if (\n    issue.secondaryLocations.length > 0 &&\n    locations.every(loc => loc.component !== issue.component)\n  ) {\n    addGroup(issue.component);\n  }\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      addGroup(loc.component);\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetOfLastGroup: boolean;\n  loadDuplications?: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      const offset = parent.getBoundingClientRect().width / 2;\n\n      scrollHorizontally(element, {\n        leftOffset: offset,\n        rightOffset: offset,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n    const noop = () => {};\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        loadDuplications={this.props.loadDuplications || noop}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={noop}\n        onIssueUnselect={noop}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      lastSnippetOfLastGroup,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = lastSnippetOfLastGroup\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications =\n      Boolean(this.props.loadDuplications) && snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/**\n * This method returns `undefined`.\n *\n * @static\n * @memberOf _\n * @since 2.3.0\n * @category Util\n * @example\n *\n * _.times(2, _.noop);\n * // => [undefined, undefined]\n */\nfunction noop() {\n  // No operation performed.\n}\n\nmodule.exports = noop;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { noop } from 'lodash';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport Issue from '../../../components/issue/Issue';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  isLastOccurenceOfPrimaryComponent: boolean;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetGroup: boolean;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetGroupViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const { issue, snippetGroup } = this.props;\n\n    const snippets = createSnippets({\n      component: snippetGroup.component.key,\n      issue,\n      locations: snippetGroup.locations\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (clickedSymbols: string[]) => {\n    this.setState(({ highlightedSymbols }) => {\n      const newHighlightedSymbols = clickedSymbols.filter(\n        symb => !highlightedSymbols.includes(symb)\n      );\n      return { highlightedSymbols: newHighlightedSymbols };\n    });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    lastSnippetOfLastGroup,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    lastSnippetOfLastGroup: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        duplications={this.props.duplications}\n        duplicationsByLine={this.props.duplicationsByLine}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        lastSnippetOfLastGroup={lastSnippetOfLastGroup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const {\n      branchLike,\n      isLastOccurenceOfPrimaryComponent,\n      issue,\n      issuesByLine,\n      issuePopup,\n      lastSnippetGroup,\n      snippetGroup\n    } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations =\n      issue.component === snippetGroup.component.key && issue.textRange !== undefined\n        ? locationsByLine([issue])\n        : {};\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    const isFlow = issue.secondaryLocations.length === 0;\n    const includeIssueLocation = isFlow ? isLastOccurenceOfPrimaryComponent : true;\n\n    return (\n      <div className=\"component-source-container\" ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {issue.component === snippetGroup.component.key && issue.textRange === undefined && (\n          <div className=\"padded-top padded-left padded-right\">\n            <Issue\n              issue={issue}\n              onChange={this.props.onIssueChange}\n              onClick={noop}\n              onPopupToggle={this.props.onIssuePopupToggle}\n              openPopup={issuePopup && issuePopup.issue === issue.key ? issuePopup.name : undefined}\n              selected={true}\n            />\n          </div>\n        )}\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine,\n              locationsByLine: includeIssueLocation ? locations : {},\n              lastSnippetOfLastGroup: lastSnippetGroup && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { findLastIndex } from 'lodash';\nimport * as React from 'react';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine as getDuplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetGroupViewer from './ComponentSourceSnippetGroupViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: getDuplicationsByLine(r.duplications)\n          });\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { issue, locations } = this.props;\n    const { components, duplications, duplicationsByLine } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(issue, locations, components);\n\n    const lastOccurenceOfPrimaryComponent = findLastIndex(\n      locationsByComponent,\n      ({ component }) => component.key === issue.component\n    );\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          return (\n            <SourceViewerContext.Provider\n              // eslint-disable-next-line react/no-array-index-key\n              key={`${issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetGroupViewer\n                branchLike={this.props.branchLike}\n                duplications={duplications}\n                duplicationsByLine={duplicationsByLine}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                isLastOccurenceOfPrimaryComponent={i === lastOccurenceOfPrimaryComponent}\n                lastSnippetGroup={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n","var toFinite = require('./toFinite');\n\n/**\n * Converts `value` to an integer.\n *\n * **Note:** This method is loosely based on\n * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted integer.\n * @example\n *\n * _.toInteger(3.2);\n * // => 3\n *\n * _.toInteger(Number.MIN_VALUE);\n * // => 0\n *\n * _.toInteger(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toInteger('3.2');\n * // => 3\n */\nfunction toInteger(value) {\n  var result = toFinite(value),\n      remainder = result % 1;\n\n  return result === result ? (remainder ? result - remainder : result) : 0;\n}\n\nmodule.exports = toInteger;\n","/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nmodule.exports = baseFindIndex;\n","var baseFindIndex = require('./_baseFindIndex'),\n    baseIteratee = require('./_baseIteratee'),\n    toInteger = require('./toInteger');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * This method is like `_.findIndex` except that it iterates over elements\n * of `collection` from right to left.\n *\n * @static\n * @memberOf _\n * @since 2.0.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @param {number} [fromIndex=array.length-1] The index to search from.\n * @returns {number} Returns the index of the found element, else `-1`.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'active': true },\n *   { 'user': 'fred',    'active': false },\n *   { 'user': 'pebbles', 'active': false }\n * ];\n *\n * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });\n * // => 2\n *\n * // The `_.matches` iteratee shorthand.\n * _.findLastIndex(users, { 'user': 'barney', 'active': true });\n * // => 0\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.findLastIndex(users, ['active', false]);\n * // => 2\n *\n * // The `_.property` iteratee shorthand.\n * _.findLastIndex(users, 'active');\n * // => 0\n */\nfunction findLastIndex(array, predicate, fromIndex) {\n  var length = array == null ? 0 : array.length;\n  if (!length) {\n    return -1;\n  }\n  var index = length - 1;\n  if (fromIndex !== undefined) {\n    index = toInteger(fromIndex);\n    index = fromIndex < 0\n      ? nativeMax(length + index, 0)\n      : nativeMin(index, length - 1);\n  }\n  return baseFindIndex(array, baseIteratee(predicate, 3), index, true);\n}\n\nmodule.exports = findLastIndex;\n"],"sourceRoot":""}
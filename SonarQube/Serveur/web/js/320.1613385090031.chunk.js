(window.webpackJsonp=window.webpackJsonp||[]).push([[320],{1066:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return p})),n.d(t,"d",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"f",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"g",(function(){return f}));var o=function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var s=arguments[t],r=0,p=s.length;r<p;r++,i++)o[i]=s[r];return o},s=11,r=9,p=50;function a(e,t){var n=e[0],o=e[1],i=t[0];return!(n>t[1]+s||o<i-s)}function u(e){return{component:e.component,textRange:e.textRange||{endLine:0,endOffset:0,startLine:0,startOffset:0}}}function c(e){var t=e.component,n=e.issue,o=e.locations,s=n.secondaryLocations.length>0,p=(s&&n.component===t&&void 0!==n.textRange?i([u(n)],o):o).reduce((function(e,t,o){var i,s=Math.max(1,t.textRange.startLine-5),p=function(e){var t=e.issue,n=e.locationEnd,o=t.textRange&&t.textRange.endLine||0;return o&&o!==n?n+5:n+r}({issue:n,locationEnd:t.textRange.endLine});return e=e.filter((function(e){if(a([e.start,e.end],[s,p])){var t=!1;return i||(i=e,t=!0),i.start=Math.min(s,e.start,i.start),i.end=Math.max(p,e.end,i.end),t}return!0})),void 0===i&&e.push({start:s,end:p,index:o}),e}),[]);return s?p.sort((function(e,t){return e.start-t.start})):p}function l(e,t){return e.map((function(e){for(var n=[],o=e.start;o<=e.end;o++)t[o]&&n.push(t[o]);return n})).filter((function(e){return e.length>0}))}function d(e,t,n){var i,s="",r=[],p=function(e){i=o(o({},n[e]||{component:{key:e,measures:{},path:"",project:"",projectName:"",q:"FIL",uuid:""},sources:[]}),{locations:[]}),r.push(i),s=e};return e.secondaryLocations.length>0&&t.every((function(t){return t.component!==e.component}))&&p(e.component),t.forEach((function(e,t){e.component!==s&&p(e.component),e.index=t,i.locations.push(e)})),r}function h(e){var t=e.direction,n=e.snippetIndex,o=e.snippets,i=o.find((function(e){return e.index===n}));if(!i)throw new Error("Snippet "+n+" not found");return i.start=Math.max(0,i.start-("up"===t?p:0)),i.end+="down"===t?p:0,o.map((function(e){return e.index===n?i:(a([e.start,e.end],[i.start,i.end])&&(i.start=Math.min(e.start,i.start),i.end=Math.max(e.end,i.end),e.toDelete=!0),e)}))}function f(e,t){return e>=t[0].line&&e<=t[t.length-1].line}},1184:function(e,t,n){"use strict";var o,i=n(660),s=n.n(i),r=n(13),p=n(1051),a=n.n(p),u=n(176),c=n(778),l=n(1149),d=n(968),h=n(1005),f=n(1118),m=(n(1197),n(1066)),g=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),y=function(e){function t(t){var n=e.call(this,t)||this;return n.doScroll=function(e){n.props.scroll&&n.props.scroll(e);var t=n.snippetNodeRef.current;if(t){var o=t.getBoundingClientRect().width/2;Object(c.scrollHorizontally)(e,{leftOffset:o,rightOffset:o,parent:t})}},n.scrollToLastExpandedRow=function(){if(n.props.scroll){var e=n.snippetNodeRef.current;if(!e)return;var t=e.querySelectorAll("tr"),o=t[t.length-1];n.props.scroll(o,100)}},n.expandBlock=function(e){return function(){return n.props.expandBlock(n.props.index,e).then((function(){"down"===e&&n.scrollToLastExpandedRow()}))}},n.snippetNodeRef=r.createRef(),n}return g(t,e),t.prototype.renderLine=function(e){var t=this,n=e.displayDuplications,o=e.displaySCM,i=e.index,s=e.issuesForLine,p=e.issueLocations,a=e.line,u=e.snippet,c=e.symbols,d=e.verticalBuffer,m=Object(h.b)(a,this.props.locations),g=this.props,y=g.duplications,b=g.duplicationsByLine,v=y?y.length:0,x=v&&b&&b[a.line]||[],A=s.some((function(e){return e.key===t.props.issue.key})),L=function(){};return r.createElement(l.a,{branchLike:this.props.branchLike,displayAllIssues:!1,displayCoverage:!0,displayDuplications:n,displayIssues:!A||s.length>1,displayLocationMarkers:!0,displaySCM:o,duplications:x,duplicationsCount:v,highlighted:!1,highlightedLocationMessage:Object(f.b)(this.props.highlightedLocationMessage,m),highlightedSymbols:Object(f.a)(c,this.props.highlightedSymbols),issueLocations:p,issuePopup:this.props.issuePopup,issues:s,key:a.line,last:!1,line:a,loadDuplications:this.props.loadDuplications||L,onIssueChange:this.props.onIssueChange,onIssuePopupToggle:this.props.onIssuePopupToggle,onIssueSelect:L,onIssueUnselect:L,onIssuesClose:this.props.handleCloseIssues,onIssuesOpen:this.props.handleOpenIssues,onLocationSelect:this.props.onLocationSelect,onSymbolClick:this.props.handleSymbolClick,openIssues:this.props.openIssuesByLine[a.line],previousLine:i>0?u[i-1]:void 0,renderDuplicationPopup:this.props.renderDuplicationPopup,scroll:this.doScroll,secondaryIssueLocations:m,selectedIssue:Object(f.c)(this.props.issue.key,s),verticalBuffer:d})},t.prototype.render=function(){var e=this,t=this.props,n=t.component,o=t.displaySCM,i=t.issue,p=t.issuesByLine,c=void 0===p?{}:p,l=t.lastSnippetOfLastGroup,h=t.locationsByLine,f=t.openIssuesByLine,g=t.snippet,y=n.measures&&n.measures.lines&&parseInt(n.measures.lines,10),b=Object(d.e)(g),v=g[g.length-1].line,x=i.textRange?i.textRange.endLine:i.line,A=Math.max.apply(Math,Object.keys(c).map((function(e){return parseInt(e,10)})).filter((function(e){return Object(m.g)(e,g)&&(e===x||f[e])}))),L=l?Math.max(0,m.b-(v-A)):0,k=Boolean(this.props.loadDuplications)&&g.some((function(e){return!!e.duplicated}));return r.createElement("div",{className:"source-viewer-code snippet",ref:this.snippetNodeRef},r.createElement("div",null,g[0].line>1&&r.createElement("div",{className:"expand-block expand-block-above"},r.createElement("button",{"aria-label":Object(u.translate)("source_viewer.expand_above"),onClick:this.expandBlock("up"),type:"button"},r.createElement(a.a,null))),r.createElement("table",{className:s()("source-table",{"expand-up":g[0].line>1,"expand-down":!y||g[g.length-1].line<y})},r.createElement("tbody",null,g.map((function(t,n){return e.renderLine({displayDuplications:k,displaySCM:o,index:n,issuesForLine:c[t.line]||[],issueLocations:h[t.line]||[],line:t,snippet:g,symbols:b[t.line],verticalBuffer:n===g.length-1?L:0})})))),(!y||g[g.length-1].line<y)&&r.createElement("div",{className:"expand-block expand-block-below"},r.createElement("button",{"aria-label":Object(u.translate)("source_viewer.expand_below"),onClick:this.expandBlock("down"),type:"button"},r.createElement(a.a,null)))))},t}(r.PureComponent);t.a=y},1197:function(e,t,n){var o=n(662),i=n(1198);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var s={insert:"head",singleton:!1},r=(o(i,s),i.locals?i.locals:{});e.exports=r},1198:function(e,t,n){(t=n(663)(!1)).push([e.i,'.snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=");top:0}.expand-block-below{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}',""]),e.exports=t},2149:function(e,t){e.exports=function(){}},2225:function(e,t,n){"use strict";n.r(t);var o,i=n(911),s=n.n(i),r=n(13),p=n(671),a=n(667),u=n.n(a),c=n(176),l=n(718),d=n(707),h=n(673),f=n(1496),m=n(1497),g=n(968),y=n(1006),b=n(961),v=n(677),x=n(2149),A=n.n(x),L=n(1026),k=n(1165),O=n(1113),S=n(1184),w=n(1066),I=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),P=function(){return(P=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.rootNodeRef=r.createRef(),t.state={additionalLines:{},highlightedSymbols:[],loading:!1,openIssuesByLine:{},snippets:[]},t.expandBlock=function(e,n){var o=t.props,i=o.branchLike,s=o.snippetGroup.component.key,r=t.state.snippets.find((function(t){return t.index===e}));if(!r)return Promise.reject();var p=w.a+w.c-1,a="up"===n?{from:Math.max(1,r.start-p),to:r.start-1}:{from:r.end+1,to:r.end+p};return Object(l.u)(P(P({key:s},a),Object(v.d)(i))).then((function(e){return e.reduce((function(e,t){return t.coverageStatus=Object(k.a)(t),e[t.line]=t,e}),{})})).then((function(o){return t.animateBlockExpansion(e,n,o)}))},t.expandComponent=function(){var e=t.props,n=e.branchLike,o=e.snippetGroup.component.key;t.setState({loading:!0}),Object(l.u)(P({key:o},Object(v.d)(n))).then((function(e){t.mounted&&t.setState((function(t){var n=t.additionalLines;return{additionalLines:P(P({},n),e),loading:!1,snippets:[{start:0,end:e[e.length-1].line,index:-1}]}}))}),(function(){t.mounted&&t.setState({loading:!1})}))},t.handleOpenIssues=function(e){t.setState((function(t){var n;return{openIssuesByLine:P(P({},t.openIssuesByLine),(n={},n[e.line]=!0,n))}}))},t.handleCloseIssues=function(e){t.setState((function(t){var n;return{openIssuesByLine:P(P({},t.openIssuesByLine),(n={},n[e.line]=!1,n))}}))},t.handleSymbolClick=function(e){t.setState((function(t){var n=t.highlightedSymbols;return{highlightedSymbols:e.filter((function(e){return!n.includes(e)}))}}))},t.loadDuplications=function(e){t.props.loadDuplications(t.props.snippetGroup.component.key,e)},t.renderDuplicationPopup=function(e,n){return t.props.renderDuplicationPopup(t.props.snippetGroup.component,e,n)},t}return I(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.createSnippetsFromProps()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.createSnippetsFromProps=function(){var e=this.props,t=e.issue,n=e.snippetGroup,o=Object(w.d)({component:n.component.key,issue:t,locations:n.locations});this.setState({snippets:o})},t.prototype.getNodes=function(e){var t=this.rootNodeRef.current;if(t){var n=t.querySelector("#snippet-wrapper-"+e);if(n){var o=n.querySelector(".snippet");if(o){var i=o.firstChild;if(i)return{wrapper:o,table:i}}}}},t.prototype.cleanDom=function(e){var t=this.getNodes(e);if(t){var n=t.wrapper;t.table.style.marginTop="",n.style.maxHeight=""}},t.prototype.setMaxHeight=function(e,t,n){void 0===n&&(n=!1);var o=this.getNodes(e);if(o){var i=o.wrapper,s=o.table,r=void 0!==t?t:s.getBoundingClientRect().height;if(n){var p=i.getBoundingClientRect().height;s.style.transition="none",s.style.marginTop=p-r+"px",setTimeout((function(){s.style.transition="",s.style.marginTop="0px",i.style.maxHeight=r+20+"px"}),0)}else i.style.maxHeight=r+20+"px"}},t.prototype.animateBlockExpansion=function(e,t,n){var o=this;if(this.mounted){var i=this.state.snippets,s=Object(w.e)({direction:t,snippetIndex:e,snippets:i}),r=s.filter((function(e){return e.toDelete}));return r.forEach((function(e){return o.setMaxHeight(e.index)})),this.setMaxHeight(e),new Promise((function(i){o.setState((function(e){var t=e.additionalLines,o=e.snippets;return{additionalLines:P(P({},t),n),snippets:o}}),(function(){r.forEach((function(e){o.setMaxHeight(e.index,0)})),o.setMaxHeight(e,void 0,"up"===t),setTimeout((function(){o.setState({snippets:s.filter((function(e){return!e.toDelete}))},i),o.cleanDom(e)}),200)}))}))}return Promise.resolve()},t.prototype.renderSnippet=function(e){var t=e.index,n=e.issuesByLine,o=e.lastSnippetOfLastGroup,i=e.locationsByLine,s=e.snippet;return r.createElement(S.a,{branchLike:this.props.branchLike,component:this.props.snippetGroup.component,duplications:this.props.duplications,duplicationsByLine:this.props.duplicationsByLine,expandBlock:this.expandBlock,handleCloseIssues:this.handleCloseIssues,handleOpenIssues:this.handleOpenIssues,handleSymbolClick:this.handleSymbolClick,highlightedLocationMessage:this.props.highlightedLocationMessage,highlightedSymbols:this.state.highlightedSymbols,index:t,issue:this.props.issue,issuePopup:this.props.issuePopup,issuesByLine:n,lastSnippetOfLastGroup:o,loadDuplications:this.loadDuplications,locations:this.props.locations,locationsByLine:i,onIssueChange:this.props.onIssueChange,onIssuePopupToggle:this.props.onIssuePopupToggle,onLocationSelect:this.props.onLocationSelect,openIssuesByLine:this.state.openIssuesByLine,renderDuplicationPopup:this.renderDuplicationPopup,scroll:this.props.scroll,snippet:s})},t.prototype.render=function(){var e=this,t=this.props,n=t.branchLike,o=t.isLastOccurenceOfPrimaryComponent,i=t.issue,s=t.issuesByLine,p=t.issuePopup,a=t.lastSnippetGroup,u=t.snippetGroup,c=this.state,l=c.additionalLines,d=c.loading,h=c.snippets,f=i.component===u.component.key&&void 0!==i.textRange?Object(g.d)([i]):{},m=1===h.length&&u.component.measures&&h[0].end-h[0].start===parseInt(u.component.measures.lines||"",10),y=Object(w.h)(h,P(P({},u.sources),l)),b=!(0===i.secondaryLocations.length)||o;return r.createElement("div",{className:"component-source-container",ref:this.rootNodeRef},r.createElement(O.a,{branchLike:n,expandable:!m,loading:d,onExpand:this.expandComponent,sourceViewerFile:u.component}),i.component===u.component.key&&void 0===i.textRange&&r.createElement("div",{className:"padded-top padded-left padded-right"},r.createElement(L.a,{issue:i,onChange:this.props.onIssueChange,onClick:A.a,onPopupToggle:this.props.onIssuePopupToggle,openPopup:p&&p.issue===i.key?p.name:void 0,selected:!0})),y.map((function(t,n){return r.createElement("div",{id:"snippet-wrapper-"+h[n].index,key:h[n].index},e.renderSnippet({snippet:t,index:h[n].index,issuesByLine:s,locationsByLine:b?f:{},lastSnippetOfLastGroup:a&&n===h.length-1}))})))},t}(r.PureComponent),j=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),B=function(){return(B=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={components:{},duplicationsByLine:{},loading:!0,notAccessible:!1},t.fetchDuplications=function(e){Object(l.q)(B({key:e},Object(v.d)(t.props.branchLike))).then((function(e){t.mounted&&t.setState({duplicatedFiles:e.files,duplications:e.duplications,duplicationsByLine:Object(g.a)(e.duplications)})}),(function(){}))},t.handleIssuePopupToggle=function(e,n,o){t.setState((function(t){var i=t.issuePopup&&t.issuePopup.name===n&&t.issuePopup.issue===e;return!1===o||i?!0!==o&&i?{issuePopup:void 0}:null:{issuePopup:{issue:e,name:n}}}))},t.renderDuplicationPopup=function(e,n,o){var i=t.state,s=i.duplicatedFiles,p=i.duplications;if(!e||!s)return null;var a=Object(m.b)(p,n);return r.createElement(b.a.Consumer,null,(function(n){var i=n.openComponent;return r.createElement(f.a,{blocks:Object(m.a)(a,o),branchLike:t.props.branchLike,duplicatedFiles:s,inRemovedComponent:Object(m.c)(a),openComponent:i,sourceViewerFile:e})}))},t}return j(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchIssueFlowSnippets(this.props.issue.key)},t.prototype.componentWillReceiveProps=function(e){e.issue.key!==this.props.issue.key&&this.fetchIssueFlowSnippets(e.issue.key)},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.fetchIssueFlowSnippets=function(e){var t=this;this.setState({loading:!0}),Object(d.h)(e).then((function(e){t.mounted&&(t.setState({components:e,issuePopup:void 0,loading:!1}),t.props.onLoaded&&t.props.onLoaded())}),(function(e){403!==e.status&&Object(h.a)(e),t.mounted&&t.setState({loading:!1,notAccessible:403===e.status})}))},t.prototype.render=function(){var e=this,t=this.state,n=t.loading,o=t.notAccessible;if(n)return r.createElement("div",null,r.createElement(u.a,null));if(o)return r.createElement(p.Alert,{className:"spacer-top",variant:"warning"},Object(c.translate)("code_viewer.no_source_code_displayed_due_to_security"));var i=this.props,a=i.issue,l=i.locations,d=this.state,h=d.components,f=d.duplications,m=d.duplicationsByLine,b=Object(g.b)(this.props.issues),v=Object(w.f)(a,l,h),x=s()(v,(function(e){return e.component.key===a.component}));return r.createElement("div",null,v.map((function(t,n){return r.createElement(y.a.Provider,{key:a.key+"-"+(e.props.selectedFlowIndex||0)+"-"+n,value:{branchLike:e.props.branchLike,file:t.component}},r.createElement(C,{branchLike:e.props.branchLike,duplications:f,duplicationsByLine:m,highlightedLocationMessage:e.props.highlightedLocationMessage,issue:a,issuePopup:e.state.issuePopup,issuesByLine:b[t.component.key]||{},isLastOccurenceOfPrimaryComponent:n===x,lastSnippetGroup:n===v.length-1,loadDuplications:e.fetchDuplications,locations:t.locations||[],onIssueChange:e.props.onIssueChange,onIssuePopupToggle:e.handleIssuePopupToggle,onLocationSelect:e.props.onLocationSelect,renderDuplicationPopup:e.renderDuplicationPopup,scroll:e.props.scroll,snippetGroup:t}))})))},t}(r.PureComponent);t.default=E},729:function(e,t,n){var o=n(706);e.exports=function(e){var t=o(e),n=t%1;return t==t?n?t-n:t:0}},756:function(e,t){e.exports=function(e,t,n,o){for(var i=e.length,s=n+(o?1:-1);o?s--:++s<i;)if(t(e[s],s,e))return s;return-1}},911:function(e,t,n){var o=n(756),i=n(682),s=n(729),r=Math.max,p=Math.min;e.exports=function(e,t,n){var a=null==e?0:e.length;if(!a)return-1;var u=a-1;return void 0!==n&&(u=s(n),u=n<0?r(a+u,0):p(u,a-1)),o(e,i(t,3),u,!0)}}}]);
//# sourceMappingURL=320.1613385090031.chunk.js.map
{"version":3,"sources":["webpack:///./node_modules/lodash/noop.js","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetGroupViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx","webpack:///./node_modules/lodash/toInteger.js","webpack:///./node_modules/lodash/_baseFindIndex.js","webpack:///./node_modules/lodash/findLastIndex.js","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?ff37","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css"],"names":["module","exports","mounted","rootNodeRef","state","additionalLines","highlightedSymbols","loading","openIssuesByLine","snippets","expandBlock","snippetIndex","direction","branchLike","snippetGroup","this","props","key","component","snippet","find","s","index","Promise","reject","extension","range","from","Math","max","start","to","end","then","lines","reduce","lineMap","line","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","setState","length","handleOpenIssues","handleCloseIssues","handleSymbolClick","clickedSymbols","filter","symb","includes","loadDuplications","renderDuplicationPopup","createSnippetsFromProps","issue","locations","root","current","element","querySelector","wrapper","table","firstChild","nodes","getNodes","style","marginTop","maxHeight","value","up","undefined","getBoundingClientRect","height","startHeight","transition","setTimeout","newSnippets","deletedSnippets","toDelete","forEach","setMaxHeight","resolve","cleanDom","issuesByLine","lastSnippetOfLastGroup","locationsByLine","SnippetViewer","duplications","duplicationsByLine","highlightedLocationMessage","issuePopup","onIssueChange","onIssuePopupToggle","onLocationSelect","scroll","isLastOccurenceOfPrimaryComponent","lastSnippetGroup","textRange","fullyShown","measures","parseInt","snippetLines","sources","includeIssueLocation","secondaryLocations","className","ref","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","Issue","onChange","onClick","onPopupToggle","openPopup","name","selected","map","id","renderSnippet","components","notAccessible","fetchDuplications","r","duplicatedFiles","files","handleIssuePopupToggle","popupName","open","samePopup","blocks","Consumer","openComponent","DuplicationPopup","inRemovedComponent","fetchIssueFlowSnippets","newProps","issueKey","onLoaded","response","status","throwGlobalError","Alert","variant","issuesByComponent","issues","locationsByComponent","lastOccurenceOfPrimaryComponent","i","SourceViewerContext","Provider","selectedFlowIndex","file","toFinite","result","remainder","array","predicate","fromIndex","fromRight","baseFindIndex","baseIteratee","toInteger","nativeMax","nativeMin","min","MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","startA","endA","startB","endB","getPrimaryLocation","endLine","endOffset","startLine","startOffset","createSnippets","params","hasSecondaryLocations","ranges","loc","startIndex","endIndex","locationEnd","issueEndLine","addLinesBellow","firstCollision","keep","push","sort","a","b","linesForSnippets","componentLines","groupLocationsByComponent","currentGroup","currentComponent","groups","addGroup","componentKey","path","project","projectName","q","uuid","every","expandSnippet","snippetToExpand","Error","inSnippet","super","doScroll","parent","snippetNodeRef","offset","width","leftOffset","rightOffset","scrollToLastExpandedRow","snippetNode","rows","querySelectorAll","lastRow","displayDuplications","displaySCM","issuesForLine","issueLocations","symbols","verticalBuffer","secondaryIssueLocations","duplicationsCount","lineDuplications","isSinkLine","some","noop","displayAllIssues","displayCoverage","displayIssues","displayLocationMarkers","highlighted","last","onIssueSelect","onIssueUnselect","onIssuesClose","onIssuesOpen","onSymbolClick","openIssues","previousLine","selectedIssue","lastLine","bottomLine","issueLine","lowestVisibleIssue","Object","keys","k","l","Boolean","duplicated","type","renderLine","api","content","__esModule","default","options","exported","locals","___CSS_LOADER_API_IMPORT___"],"mappings":"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","file":"js/320.m.87bf63fd.chunk.js","sourcesContent":["/**\n * This method returns `undefined`.\n *\n * @static\n * @memberOf _\n * @since 2.3.0\n * @category Util\n * @example\n *\n * _.times(2, _.noop);\n * // => [undefined, undefined]\n */\nfunction noop() {\n  // No operation performed.\n}\n\nmodule.exports = noop;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { noop } from 'lodash';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport Issue from '../../../components/issue/Issue';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  isLastOccurenceOfPrimaryComponent: boolean;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetGroup: boolean;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetGroupViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const { issue, snippetGroup } = this.props;\n\n    const snippets = createSnippets({\n      component: snippetGroup.component.key,\n      issue,\n      locations: snippetGroup.locations\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (clickedSymbols: string[]) => {\n    this.setState(({ highlightedSymbols }) => {\n      const newHighlightedSymbols = clickedSymbols.filter(\n        symb => !highlightedSymbols.includes(symb)\n      );\n      return { highlightedSymbols: newHighlightedSymbols };\n    });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    lastSnippetOfLastGroup,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    lastSnippetOfLastGroup: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        duplications={this.props.duplications}\n        duplicationsByLine={this.props.duplicationsByLine}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        lastSnippetOfLastGroup={lastSnippetOfLastGroup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const {\n      branchLike,\n      isLastOccurenceOfPrimaryComponent,\n      issue,\n      issuesByLine,\n      issuePopup,\n      lastSnippetGroup,\n      snippetGroup\n    } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations =\n      issue.component === snippetGroup.component.key && issue.textRange !== undefined\n        ? locationsByLine([issue])\n        : {};\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    const isFlow = issue.secondaryLocations.length === 0;\n    const includeIssueLocation = isFlow ? isLastOccurenceOfPrimaryComponent : true;\n\n    return (\n      <div className=\"component-source-container\" ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {issue.component === snippetGroup.component.key && issue.textRange === undefined && (\n          <div className=\"padded-top padded-left padded-right\">\n            <Issue\n              issue={issue}\n              onChange={this.props.onIssueChange}\n              onClick={noop}\n              onPopupToggle={this.props.onIssuePopupToggle}\n              openPopup={issuePopup && issuePopup.issue === issue.key ? issuePopup.name : undefined}\n              selected={true}\n            />\n          </div>\n        )}\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine,\n              locationsByLine: includeIssueLocation ? locations : {},\n              lastSnippetOfLastGroup: lastSnippetGroup && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { findLastIndex } from 'lodash';\nimport * as React from 'react';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine as getDuplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetGroupViewer from './ComponentSourceSnippetGroupViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: getDuplicationsByLine(r.duplications)\n          });\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { issue, locations } = this.props;\n    const { components, duplications, duplicationsByLine } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(issue, locations, components);\n\n    const lastOccurenceOfPrimaryComponent = findLastIndex(\n      locationsByComponent,\n      ({ component }) => component.key === issue.component\n    );\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          return (\n            <SourceViewerContext.Provider\n              // eslint-disable-next-line react/no-array-index-key\n              key={`${issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetGroupViewer\n                branchLike={this.props.branchLike}\n                duplications={duplications}\n                duplicationsByLine={duplicationsByLine}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                isLastOccurenceOfPrimaryComponent={i === lastOccurenceOfPrimaryComponent}\n                lastSnippetGroup={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n","var toFinite = require('./toFinite');\n\n/**\n * Converts `value` to an integer.\n *\n * **Note:** This method is loosely based on\n * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted integer.\n * @example\n *\n * _.toInteger(3.2);\n * // => 3\n *\n * _.toInteger(Number.MIN_VALUE);\n * // => 0\n *\n * _.toInteger(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toInteger('3.2');\n * // => 3\n */\nfunction toInteger(value) {\n  var result = toFinite(value),\n      remainder = result % 1;\n\n  return result === result ? (remainder ? result - remainder : result) : 0;\n}\n\nmodule.exports = toInteger;\n","/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nmodule.exports = baseFindIndex;\n","var baseFindIndex = require('./_baseFindIndex'),\n    baseIteratee = require('./_baseIteratee'),\n    toInteger = require('./toInteger');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * This method is like `_.findIndex` except that it iterates over elements\n * of `collection` from right to left.\n *\n * @static\n * @memberOf _\n * @since 2.0.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @param {number} [fromIndex=array.length-1] The index to search from.\n * @returns {number} Returns the index of the found element, else `-1`.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'active': true },\n *   { 'user': 'fred',    'active': false },\n *   { 'user': 'pebbles', 'active': false }\n * ];\n *\n * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });\n * // => 2\n *\n * // The `_.matches` iteratee shorthand.\n * _.findLastIndex(users, { 'user': 'barney', 'active': true });\n * // => 0\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.findLastIndex(users, ['active', false]);\n * // => 2\n *\n * // The `_.property` iteratee shorthand.\n * _.findLastIndex(users, 'active');\n * // => 0\n */\nfunction findLastIndex(array, predicate, fromIndex) {\n  var length = array == null ? 0 : array.length;\n  if (!length) {\n    return -1;\n  }\n  var index = length - 1;\n  if (fromIndex !== undefined) {\n    index = toInteger(fromIndex);\n    index = fromIndex < 0\n      ? nativeMax(length + index, 0)\n      : nativeMin(index, length - 1);\n  }\n  return baseFindIndex(array, baseIteratee(predicate, 3), index, true);\n}\n\nmodule.exports = findLastIndex;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nexport function getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  component: string;\n  issue: T.Issue;\n  locations: T.FlowLocation[];\n}): T.Snippet[] {\n  const { component, issue, locations } = params;\n\n  const hasSecondaryLocations = issue.secondaryLocations.length > 0;\n  const addIssueLocation =\n    hasSecondaryLocations && issue.component === component && issue.textRange !== undefined;\n\n  // For each location: compute its range, and then compare with other ranges\n  // to merge snippets that collide.\n  const ranges = (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n\n  // Sort snippets by line number in the case of secondary locations\n  // Preserve location order for flows!\n  return hasSecondaryLocations ? ranges.sort((a, b) => a.start - b.start) : ranges;\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  issue: T.Issue,\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  const addGroup = (componentKey: string) => {\n    currentGroup = {\n      ...(components[componentKey] || unknownComponent(componentKey)),\n      locations: []\n    };\n    groups.push(currentGroup);\n    currentComponent = componentKey;\n  };\n\n  if (\n    issue.secondaryLocations.length > 0 &&\n    locations.every(loc => loc.component !== issue.component)\n  ) {\n    addGroup(issue.component);\n  }\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      addGroup(loc.component);\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetOfLastGroup: boolean;\n  loadDuplications?: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      const offset = parent.getBoundingClientRect().width / 2;\n\n      scrollHorizontally(element, {\n        leftOffset: offset,\n        rightOffset: offset,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n    const noop = () => {};\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        loadDuplications={this.props.loadDuplications || noop}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={noop}\n        onIssueUnselect={noop}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      lastSnippetOfLastGroup,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = lastSnippetOfLastGroup\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications =\n      Boolean(this.props.loadDuplications) && snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n"],"sourceRoot":""}